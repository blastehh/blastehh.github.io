<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Netboots | Knowledge Base</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="manifest" href="/manifest.json">
    <script src="/script/medium-zoom.min.js"></script>
    <meta name="description" content="Techie Things to Remember">
    <meta HTTP-EQUIV="Content-Security-Policy" CONTENT="default-src &#39;self&#39; ; script-src &#39;self&#39; &#39;sha256-RI2wTKrX7ok6EAjqxellug203gYTRtLlYn3x1O4Q2Lg=&#39;; style-src &#39;self&#39;; style-src-attr &#39;unsafe-hashes&#39; &#39;sha256-U3Dvsi7idr0GtxsC6hd4YstZNXAAsMdt6Wz0zJdYrKw=&#39;;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.1a2ed2f3.css" as="style"><link rel="preload" href="/assets/js/app.5ec0f833.js" as="script"><link rel="preload" href="/assets/js/2.e3d7a0c0.js" as="script"><link rel="preload" href="/assets/js/5.6bac8baf.js" as="script"><link rel="preload" href="/assets/js/16.70747ffb.js" as="script"><link rel="preload" href="/assets/js/6.87a7cc97.js" as="script"><link rel="prefetch" href="/assets/js/10.97b3d5ee.js"><link rel="prefetch" href="/assets/js/11.3e33b5f1.js"><link rel="prefetch" href="/assets/js/12.f00fed31.js"><link rel="prefetch" href="/assets/js/13.51db0fc1.js"><link rel="prefetch" href="/assets/js/14.bcfaff3d.js"><link rel="prefetch" href="/assets/js/15.ac4a2195.js"><link rel="prefetch" href="/assets/js/17.1c9e97f3.js"><link rel="prefetch" href="/assets/js/18.f0446ac9.js"><link rel="prefetch" href="/assets/js/19.5f2352ad.js"><link rel="prefetch" href="/assets/js/20.b2e4e9b8.js"><link rel="prefetch" href="/assets/js/21.3a2c3111.js"><link rel="prefetch" href="/assets/js/22.8245776b.js"><link rel="prefetch" href="/assets/js/23.98e6ac8b.js"><link rel="prefetch" href="/assets/js/24.50b888ea.js"><link rel="prefetch" href="/assets/js/25.d81ce868.js"><link rel="prefetch" href="/assets/js/26.eede1faf.js"><link rel="prefetch" href="/assets/js/27.fcf10c9b.js"><link rel="prefetch" href="/assets/js/28.0cf4a1a9.js"><link rel="prefetch" href="/assets/js/29.df9d5304.js"><link rel="prefetch" href="/assets/js/3.ea477072.js"><link rel="prefetch" href="/assets/js/30.19f4d549.js"><link rel="prefetch" href="/assets/js/31.27836410.js"><link rel="prefetch" href="/assets/js/32.e679dd6a.js"><link rel="prefetch" href="/assets/js/33.3f045d2d.js"><link rel="prefetch" href="/assets/js/34.3e50fdc7.js"><link rel="prefetch" href="/assets/js/35.f6bc730a.js"><link rel="prefetch" href="/assets/js/36.9b33848b.js"><link rel="prefetch" href="/assets/js/37.09a85cf4.js"><link rel="prefetch" href="/assets/js/38.5f339744.js"><link rel="prefetch" href="/assets/js/39.7a488b1c.js"><link rel="prefetch" href="/assets/js/4.a6aa5e67.js"><link rel="prefetch" href="/assets/js/40.024c83c5.js"><link rel="prefetch" href="/assets/js/41.b73de863.js"><link rel="prefetch" href="/assets/js/42.2b294dba.js"><link rel="prefetch" href="/assets/js/43.4b2923b7.js"><link rel="prefetch" href="/assets/js/44.fb99ceb4.js"><link rel="prefetch" href="/assets/js/45.ade9d54a.js"><link rel="prefetch" href="/assets/js/46.6c5e1e38.js"><link rel="prefetch" href="/assets/js/47.11068d86.js"><link rel="prefetch" href="/assets/js/48.95bf5574.js"><link rel="prefetch" href="/assets/js/49.abfc8d05.js"><link rel="prefetch" href="/assets/js/50.a8438487.js"><link rel="prefetch" href="/assets/js/51.cc3abadc.js"><link rel="prefetch" href="/assets/js/52.43305e5b.js"><link rel="prefetch" href="/assets/js/53.5db3673d.js"><link rel="prefetch" href="/assets/js/54.648542f3.js"><link rel="prefetch" href="/assets/js/55.8fa1ccae.js"><link rel="prefetch" href="/assets/js/56.501331fd.js"><link rel="prefetch" href="/assets/js/57.1908dbea.js"><link rel="prefetch" href="/assets/js/58.41b9b389.js"><link rel="prefetch" href="/assets/js/59.d5dc0915.js"><link rel="prefetch" href="/assets/js/60.daaee099.js"><link rel="prefetch" href="/assets/js/61.f2cb548f.js"><link rel="prefetch" href="/assets/js/62.5ee90d0d.js"><link rel="prefetch" href="/assets/js/63.aa40482e.js"><link rel="prefetch" href="/assets/js/7.150705c2.js"><link rel="prefetch" href="/assets/js/8.3e94aea9.js"><link rel="prefetch" href="/assets/js/9.2640b090.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1a2ed2f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Knowledge Base</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/blastehh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://m.blasteh.uk/@blasteh" target="_blank" rel="me" class="nav-link external">
  Fediverse
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div><div class="nav-item"><a href="https://github.com/blastehh" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://m.blasteh.uk/@blasteh" target="_blank" rel="me" class="nav-link external">
  Fediverse
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Cisco</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ESXi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guides</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OpenVPN</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Other Stuff</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/others/clearos.html" class="sidebar-link">ClearOS</a></li><li><a href="/others/dns.html" class="sidebar-link">DNS Stuff</a></li><li><a href="/others/freenas.html" class="sidebar-link">FreeNAS</a></li><li><a href="/others/git.html" class="sidebar-link">Git</a></li><li><a href="/others/ilo.html" class="sidebar-link">iLO</a></li><li><a href="/others/links.html" class="sidebar-link">Useful Links</a></li><li><a href="/others/pxe.html" aria-current="page" class="active sidebar-link">Netboots</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/others/pxe.html#ipxe-setup" class="sidebar-link">iPXE Setup</a></li><li class="sidebar-sub-header"><a href="/others/pxe.html#pxe-setup" class="sidebar-link">PXE Setup</a></li><li class="sidebar-sub-header"><a href="/others/pxe.html#preseed" class="sidebar-link">Preseed</a></li><li class="sidebar-sub-header"><a href="/others/pxe.html#ubuntu-20-04" class="sidebar-link">Ubuntu 20.04</a></li><li class="sidebar-sub-header"><a href="/others/pxe.html#almalinux-9" class="sidebar-link">Almalinux 9</a></li></ul></li><li><a href="/others/vscode.html" class="sidebar-link">vscode</a></li><li><a href="/others/vuepress.html" class="sidebar-link">Vuepress</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Synology NAS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Windows</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="netboots"><a href="#netboots" class="header-anchor">#</a> Netboots</h1> <p>All things related to network booting, pxe etc...</p> <hr> <p></p><div class="table-of-contents"><ul><li><a href="#ipxe-setup">iPXE Setup</a><ul><li><a href="#load-a-remote-script">Load a remote script</a></li><li><a href="#ubuntu-18-04-auto-install">Ubuntu 18.04 Auto install</a></li><li><a href="#boot-script">Boot Script</a></li></ul></li><li><a href="#pxe-setup">PXE Setup</a><ul><li><a href="#tftp-server">TFTP Server</a></li><li><a href="#webserver">Webserver</a></li><li><a href="#dhcp-setup">DHCP Setup</a></li></ul></li><li><a href="#preseed">Preseed</a><ul><li><a href="#ubuntu">Ubuntu</a></li></ul></li><li><a href="#ubuntu-20-04">Ubuntu 20.04</a></li><li><a href="#almalinux-9">Almalinux 9</a></li></ul></div><p></p> <h2 id="ipxe-setup"><a href="#ipxe-setup" class="header-anchor">#</a> iPXE Setup</h2> <p>Explanation of how to use iPXE</p> <h3 id="load-a-remote-script"><a href="#load-a-remote-script" class="header-anchor">#</a> Load a remote script</h3> <p>This will load a boot script from a remote server</p> <div class="language- extra-class"><pre class="language-text"><code>#!ipxe chain http://&lt;webserver&gt;/ipxe/boot
</code></pre></div><h3 id="ubuntu-18-04-auto-install"><a href="#ubuntu-18-04-auto-install" class="header-anchor">#</a> Ubuntu 18.04 Auto install</h3> <div class="language- extra-class"><pre class="language-text"><code>#!ipxe
set base-url http://&lt;webserver&gt;

echo Starting Ubuntu 18.04 Installer
kernel -n 1804a ${base-url}/ipxe/ubuntu/1804/linux
initrd ${base-url}/ipxe/ubuntu/1804/initrd.gz
imgargs 1804a initrd=initrd.gz locale=en_GB console-setup/ask_detect=false debian-installer/keymap=gb domain=localdomain hostname=unassigned auto priority=critical netcfg/choose_interface=auto preseed/url=${base-url}/ipxe/ubuntu/1804/preseed.cfg
boot 1804a
</code></pre></div><p>See <a href="#preseed">Preseed</a></p> <h3 id="boot-script"><a href="#boot-script" class="header-anchor">#</a> Boot Script</h3> <p>This is the boot script on the remote web server.
Windows installations probably don't work due to driver issues.</p> <div class="language- extra-class"><pre class="language-text"><code>#!ipxe
set base-url http://&lt;webserver&gt;

set menu-timeout 30000
set submenu-timeout ${menu-timeout}
isset ${menu-default} || set menu-default exit

:start
menu iPXE boot menu

item --gap --             ------------------------- Install Menu -----------------------------------
item ubuntu1604 Install Ubuntu 16.04 from public archive
item ubuntu1804 Install Ubuntu 18.04 from public archive
item server2012r2 Install Windows Server 2012 R2
item server2012r2wim Install Windows Server 2012 R2 using wimboot
item --gap --             ------------------------- Advanced options -------------------------------
item rescue64             Launch SYSRescue64
item shell                Drop to iPXE shell
item reboot               Reboot computer
item
item --key x exit         Exit iPXE and continue BIOS boot
choose --timeout ${menu-timeout} --default ${menu-default} selected || goto cancel
set menu-timeout 0
goto ${selected}

:cancel
echo You cancelled the menu, dropping you to a shell

:shell
echo Type 'exit' to get the back to the menu
shell
set menu-timeout 0
set submenu-timeout 0
goto start

:failed
echo Booting failed, dropping to shell
goto shell

:reboot
reboot

:exit
exit

:rescue64
echo Starting SYSRescue64
initrd ${base-url}/ipxe/rescue/isolinux/initram.igz
chain ${base-url}/ipxe/rescue/isolinux/rescue64 dodhcp netboot=${base-url}/ipxe/rescue/sysrcd.dat || goto failed

:ubuntu1604
echo Starting Ubuntu 16.04 Installer
kernel ${base-url}/ipxe/ubuntu/1604/linux
initrd ${base-url}/ipxe/ubuntu/1604/initrd.gz
#imgargs linux auto=true url=${base-url}/ipxe/ubuntu/preseed.cfg
boot || goto failed

:ubuntu1804
echo Starting Ubuntu 18.04 Installer
kernel ${base-url}/ipxe/ubuntu/1804/linux
initrd ${base-url}/ipxe/ubuntu/1804/initrd.gz
#imgargs linux auto=true url=${base-url}/ipxe/ubuntu/preseed.cfg
boot || goto failed

:server2012r2
echo Starting Windows Server 2012 R2 Installer
sanboot --no-describe ${base-url}/ipxe/win/en_windows_server_2012_r2_x64_dvd_2707946.iso || goto failed

:server2012r2wim
echo Starting Windows Server 2012 R2 Installer
kernel ${base-url}/ipxe/wimboot
initrd ${base-url}/ipxe/win/iso/2012r2/x64/bootmgr bootmgr
initrd ${base-url}/ipxe/win/iso/2012r2/x64/boot/bcd BCD
initrd ${base-url}/ipxe/win/iso/2012r2/x64/boot/boot.sdi boot.sdi
initrd ${base-url}/ipxe/win/iso/2012r2/x64/sources/boot.wim boot.wim
boot || goto failed
</code></pre></div><h2 id="pxe-setup"><a href="#pxe-setup" class="header-anchor">#</a> PXE Setup</h2> <p>Explanation of how the PXE installation is configured on the home network.</p> <h3 id="tftp-server"><a href="#tftp-server" class="header-anchor">#</a> TFTP Server</h3> <p>You will need a TFTP server to serve up the initial netboot files.
<img src="/assets/img/tftptree.ef1a6526.png" alt=""></p> <p>The Ubuntu files are available from the official repository
<img src="/assets/img/ubuntufiles.3dd9a51e.png" alt=""></p> <p>Contents of <code>default</code> file</p> <div class="language- extra-class"><pre class="language-text"><code>default vesamenu.c32
path boot-screens/
prompt 0
timeout 150
ONTIMEOUT local
MENU TITLE Select a boot option

LABEL local
  MENU LABEL Boot From ^Local Disk
  LOCALBOOT 0

LABEL rescue64
  MENU LABEL Launch ^Rescue64
  KERNEL images/rescue/isolinux/rescue64
  APPEND initrd=images/rescue/isolinux/initram.igz dodhcp netboot=http://192.168.10.250/rescue/sysrcd.dat

LABEL rescue
  MENU LABEL Ubuntu 16.04 Rescue mode
  kernel images/ubuntu/xenial/amd64/linux
  append vga=788 initrd=images/ubuntu/xenial/amd64/initrd.gz rescue/enable=true --- quiet

MENU SEPARATOR

MENU BEGIN Install
MENU TITLE Select an OS to install

  LABEL Go Back
    MENU EXIT
  
  LABEL Centos-7.0-x86_64
    MENU LABEL Install CentOS 7.0 x86_64 (Manual attended install)
    KERNEL images/centos/7.0/x86_64/vmlinuz
    APPEND initrd=images/centos/7.0/x86_64/initrd.img ramdisk_size=100000 ip=dhcp inst.repo=http://centos.serverspace.co.uk/centos/7/os/x86_64

  LABEL Ubuntu-16.04-Xenial
    MENU LABEL Network Install Ubuntu 16.04 (^Xenial)
    KERNEL images/ubuntu/xenial/amd64/linux
    APPEND initrd=images/ubuntu/xenial/amd64/initrd.gz ramdisk_size=16432 locale=en_GB console-setup/ask_detect=false debian-installer/keymap=gb domain=localdomain hostname=unassigned auto url=http://192.168.10.250/dist/ubuntu/1604std.cfg

  LABEL Ubuntu-16.04-Xenial-man
    MENU LABEL Manual Network Install Ubuntu 16.04 (Xenial)
    KERNEL images/ubuntu/xenial/amd64/linux
    APPEND initrd=images/ubuntu/xenial/amd64/initrd.gz ramdisk_size=16432 locale=en_GB console-setup/ask_detect=false debian-installer/keymap=gb domain=localdomain hostname=unassigned

	
  LABEL Ubuntu-18.04-BionicBeaver
    MENU LABEL Network Install Ubuntu 18.04 (^Bionic Beaver)
    KERNEL images/ubuntu/bionic/amd64/linux
    APPEND initrd=images/ubuntu/bionic/amd64/initrd.gz ramdisk_size=16432 locale=en_GB console-setup/ask_detect=false debian-installer/keymap=gb domain=localdomain hostname=unassigned auto url=http://192.168.10.250/dist/ubuntu/1804std.cfg

MENU END
</code></pre></div><h3 id="webserver"><a href="#webserver" class="header-anchor">#</a> Webserver</h3> <p>The webserver holds the installation files and the preseed script which will be specified in the TFTP section. E.g. <code>http://192.168.10.250/dist/ubuntu/1604std.cfg</code></p> <p>See <a href="#preseed">Preseed</a></p> <h3 id="dhcp-setup"><a href="#dhcp-setup" class="header-anchor">#</a> DHCP Setup</h3> <p>DHCP has to be set up to point at your initial netboot server, which is a tftp server.
<img src="/assets/img/dhcp.0d1b3287.png" alt=""></p> <h2 id="preseed"><a href="#preseed" class="header-anchor">#</a> Preseed</h2> <p>Example preseed scripts used in the current deployment.
Passwords have been removed, see <a href="/linux/pass.html#create-a-password-using-a-command">mkpasswd</a> on how to generate a password.</p> <h3 id="ubuntu"><a href="#ubuntu" class="header-anchor">#</a> Ubuntu</h3> <h4 id="ubuntu-16-04-preseed-script"><a href="#ubuntu-16-04-preseed-script" class="header-anchor">#</a> Ubuntu 16.04 Preseed Script</h4> <div class="language- extra-class"><pre class="language-text"><code>#### Contents of the preconfiguration file (for xenial)

### Localization
d-i debian-installer/locale string en_GB

# Keyboard selection.
# Disable automatic (interactive) keymap detection.
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/xkb-keymap select gb

### Network configuration
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string unassigned
d-i netcfg/get_domain string localdomain

# Disable that annoying WEP key dialog.
d-i netcfg/wireless_wep string

### Mirror settings
d-i mirror/country string manual
d-i mirror/http/hostname string 192.168.10.250
d-i mirror/http/directory string /dist/ubuntu/ubuntu1604
d-i mirror/http/proxy string
d-i mirror/suite string xenial

### Account setup
# To create a normal user account.
d-i passwd/user-fullname string m00
d-i passwd/username string m00
d-i passwd/user-password-crypted password $6$&lt;snip&gt;
d-i user-setup/allow-password-weak boolean true

# Set to true if you want to encrypt the first user's home directory.
d-i user-setup/encrypt-home boolean false

### Clock and time zone setup
d-i clock-setup/utc boolean true
d-i time/zone string Europe/London
d-i clock-setup/ntp boolean true
d-i clock-setup/ntp-server string pool.ntp.org

### Partitioning
d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string lvm
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman-auto-lvm/guided_size string max
d-i partman-auto/choose_recipe select atomic
d-i partman/default_filesystem string ext4
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

### Base system installation
d-i base-installer/install-recommends boolean true
d-i base-installer/kernel/image string linux-generic

### Package selection
tasksel tasksel/first multiselect standard

# Individual additional packages to install
d-i pkgsel/include string openssh-server open-vm-tools python-simplejson curl cifs-utils software-properties-common binutils
d-i pkgsel/upgrade select full-upgrade
d-i pkgsel/update-policy select unattended-upgrades

d-i grub-installer/only_debian boolean true
d-i grub-installer/bootdev  string default

d-i finish-install/reboot_in_progress note
d-i cdrom-detect/eject boolean false

# in-target sh -c 'usermod -p &quot;&quot; m00'; \
# in-target sh -c 'passwd -e m00'; \

#### Advanced options
### Running custom commands during the installation
d-i preseed/late_command string \
 in-target sh -c 'usermod -p &quot;!&quot; root'; \
 in-target sh -c 'mkdir -p --mode=0700 /root/.ssh &amp;&amp; echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5KaNzN+dE9ZU83seeXSJb5gX4xRANc7eHNbQuyMXvBGSP942UpHrKgmb2Hd+f1sxH5FeLaE82p4T5Hxa+YbSEKT6VQEiktqRDmTSjiTtl2GEjaDedi0UTXB/D8nZXIbsrfkAwdQ3DgSUi7X7bdPBK43ZFE81qIPzAvl0rKhrAgJcY1HFQhlNmMzxNhPWSG9s0OqmSviC1tGooicpBLr9ibBPiQ5uc5pimYRbd6+zIbFNjNy/SqT+pWVF8J6Qp4GnHIpZZ1TMn3xluYL28zD5B5ItC8gDxfH/uaalRwe0NLEPTwWkT3ipwFaFwH8vZFCdaVU8KqUSpWH59VNHFTbKt&quot; &gt; /root/.ssh/authorized_keys &amp;&amp; chmod 0600 /root/.ssh/authorized_keys';  \
 in-target sh -c 'mkdir -p --mode=0700 /home/m00/.ssh &amp;&amp; echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5KaNzN+dE9ZU83seeXSJb5gX4xRANc7eHNbQuyMXvBGSP942UpHrKgmb2Hd+f1sxH5FeLaE82p4T5Hxa+YbSEKT6VQEiktqRDmTSjiTtl2GEjaDedi0UTXB/D8nZXIbsrfkAwdQ3DgSUi7X7bdPBK43ZFE81qIPzAvl0rKhrAgJcY1HFQhlNmMzxNhPWSG9s0OqmSviC1tGooicpBLr9ibBPiQ5uc5pimYRbd6+zIbFNjNy/SqT+pWVF8J6Qp4GnHIpZZ1TMn3xluYL28zD5B5ItC8gDxfH/uaalRwe0NLEPTwWkT3ipwFaFwH8vZFCdaVU8KqUSpWH59VNHFTbKt&quot; &gt; /home/m00/.ssh/authorized_keys &amp;&amp; chmod 0600 /home/m00/.ssh/authorized_keys &amp;&amp; chown -R m00:m00 /home/m00/.ssh';  \
 in-target sh -c 'echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6NfziEHlyzmxiU1ftIMyx8Hh8CbgiawB+wZb02aJd0Uc3lrcm+YGVxCa2jXr9hTO/YT30u4r+X91wGRJblPwyt94OqnwbGmTT+awnwshWfI8h+SP64Y4C+O9vX6b7TCmIsiXBjY35x79QfjFjHkMIZETGrU2M0v8AgfnASPR2VZw89herazZSCcvDZzmg7onGxsNulzp0s6+ldJo27clD9lXfkYtH5oZJZ+60S+lSzcAgE/EkNCAC/XwMj/qoCH2CO/oS+PR+sittw7EwJCMkt7QkQtvTDyPaLA6i2vp7JyEx8KkdsTnZm4yRr9m/I9rk3tR4DS9oj2+MPL0sfkjhMmL0jpuQaQYQczYVNo5hhAFkiVQecXHPr4G9xz4MfUy02oWGqm0hYNuWXaD1VG8Ysg3sIJQOUL7mRpjcpXh3cqP1CYF2oyKwWJh8Mwxr8nnD+F3iFJrcYqA+tgbZ+WMHLTgROK/lGVzuDx73NI9g4K0kfXjxX4AFfLjwVJmOPzzxGnAftCGFrbjENUhiwF9wBh8t825mnlItAPXo7xImmQbjwKyR5m3HKtDbXiFCbtP9DyoocABphK7+9s7kTgJnD0hzW1GqMLlWFrxRWgQniJX/ChbEaZovaLdUncPrun3HFpqQk+Np0q+l8K0CW16PYjUkZNq7warhRZ1YcKHT2Q== ansible@blasteh.uk&quot; &gt;&gt; /home/m00/.ssh/authorized_keys';  \
 in-target sh -c 'sed -i &quot;s/.*PermitRootLogin.*/PermitRootLogin prohibit-password/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'sed -i &quot;s/.*PasswordAuthentication.*/PasswordAuthentication no/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'sed -i &quot;s|192.168.10.250/dist/ubuntu/ubuntu1604|gb.archive.ubuntu.com/ubuntu|g&quot; /etc/apt/sources.list'; \
 in-target sh -c 'apt-get update &amp;&amp; apt-get upgrade -y';
</code></pre></div><h4 id="ubuntu-18-04-preseed-script-for-raid-1-ovh"><a href="#ubuntu-18-04-preseed-script-for-raid-1-ovh" class="header-anchor">#</a> Ubuntu 18.04 Preseed script for raid 1 (OVH)</h4> <div class="language- extra-class"><pre class="language-text"><code>#### Contents of the preconfiguration file (for bionic)
d-i debian-installer/locale string en_GB
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/xkb-keymap select gb
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string unassigned
d-i netcfg/get_domain string localdomain
d-i netcfg/wireless_wep string
d-i mirror/country string manual
d-i mirror/http/hostname string archive.ubuntu.com
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string
d-i mirror/http/mirror select gb.archive.ubuntu.com
d-i passwd/make-user boolean false
d-i passwd/user-fullname string ubuntu
d-i passwd/username string ubuntu
d-i passwd/user-password-crypted password $6$&lt;snip&gt;
d-i user-setup/allow-password-weak boolean true
d-i user-setup/encrypt-home boolean false
d-i clock-setup/utc boolean true
d-i time/zone string Europe/London
d-i clock-setup/ntp boolean true
d-i clock-setup/ntp-server string pool.ntp.org

d-i partman-auto/disk string /dev/sda /dev/sdb
d-i partman-auto/method string raid
d-i partman-auto-raid/recipe string \
  1 2 0 ext3 /boot /dev/sda1#/dev/sdb1 . \
  1 2 0 swap - /dev/sda2#/dev/sdb2 . \
  1 2 0 ext4 / /dev/sda3#/dev/sdb3 .
d-i partman-auto/expert_recipe string \
    multiraid ::                                    \
        512 512 512 raid                            \
            $primary{ } $bootable{ }                \
            method{ raid }                          \
            $lvmignore{ }                           \
        .                                           \
        1024 8000 4096 raid                         \
            $primary{ } method{ raid }              \
            $lvmignore{ }                           \
        .                                           \
        2048 10000 0 raid                           \
            $primary{ } method{ raid }              \
            $lvmignore{ }                           \
        .
d-i partman-md/device_remove_md boolean true
d-i partman-md/confirm boolean true
d-i partman-md/confirm_nooverwrite boolean true
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman/default_filesystem string ext4
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
d-i partman/choose_partition select finish
d-i base-installer/install-recommends boolean true
d-i base-installer/kernel/image string linux-generic
tasksel tasksel/first multiselect standard
d-i pkgsel/include string openssh-server python-simplejson curl cifs-utils software-properties-common binutils
d-i pkgsel/upgrade select full-upgrade
d-i pkgsel/update-policy select unattended-upgrades
d-i grub-installer/only_debian boolean true
d-i grub-installer/bootdev  string default
d-i finish-install/reboot_in_progress note
d-i cdrom-detect/eject boolean false
d-i preseed/late_command string \
 in-target sh -c 'usermod -p &quot;!&quot; root'; \
 in-target sh -c 'mkdir -p --mode=0700 /root/.ssh &amp;&amp; echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5KaNzN+dE9ZU83seeXSJb5gX4xRANc7eHNbQuyMXvBGSP942UpHrKgmb2Hd+f1sxH5FeLaE82p4T5Hxa+YbSEKT6VQEiktqRDmTSjiTtl2GEjaDedi0UTXB/D8nZXIbsrfkAwdQ3DgSUi7X7bdPBK43ZFE81qIPzAvl0rKhrAgJcY1HFQhlNmMzxNhPWSG9s0OqmSviC1tGooicpBLr9ibBPiQ5uc5pimYRbd6+zIbFNjNy/SqT+pWVF8J6Qp4GnHIpZZ1TMn3xluYL28zD5B5ItC8gDxfH/uaalRwe0NLEPTwWkT3ipwFaFwH8vZFCdaVU8KqUSpWH59VNHFTbKt&quot; &gt; /root/.ssh/authorized_keys &amp;&amp; chmod 0600 /root/.ssh/authorized_keys';  \
 in-target sh -c 'echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6NfziEHlyzmxiU1ftIMyx8Hh8CbgiawB+wZb02aJd0Uc3lrcm+YGVxCa2jXr9hTO/YT30u4r+X91wGRJblPwyt94OqnwbGmTT+awnwshWfI8h+SP64Y4C+O9vX6b7TCmIsiXBjY35x79QfjFjHkMIZETGrU2M0v8AgfnASPR2VZw89herazZSCcvDZzmg7onGxsNulzp0s6+ldJo27clD9lXfkYtH5oZJZ+60S+lSzcAgE/EkNCAC/XwMj/qoCH2CO/oS+PR+sittw7EwJCMkt7QkQtvTDyPaLA6i2vp7JyEx8KkdsTnZm4yRr9m/I9rk3tR4DS9oj2+MPL0sfkjhMmL0jpuQaQYQczYVNo5hhAFkiVQecXHPr4G9xz4MfUy02oWGqm0hYNuWXaD1VG8Ysg3sIJQOUL7mRpjcpXh3cqP1CYF2oyKwWJh8Mwxr8nnD+F3iFJrcYqA+tgbZ+WMHLTgROK/lGVzuDx73NI9g4K0kfXjxX4AFfLjwVJmOPzzxGnAftCGFrbjENUhiwF9wBh8t825mnlItAPXo7xImmQbjwKyR5m3HKtDbXiFCbtP9DyoocABphK7+9s7kTgJnD0hzW1GqMLlWFrxRWgQniJX/ChbEaZovaLdUncPrun3HFpqQk+Np0q+l8K0CW16PYjUkZNq7warhRZ1YcKHT2Q== ansible@blasteh.uk&quot; &gt;&gt; /root/.ssh/authorized_keys';  \
 in-target sh -c 'sed -i &quot;s/.*PermitRootLogin.*/PermitRootLogin prohibit-password/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'sed -i &quot;s/.*PasswordAuthentication.*/PasswordAuthentication no/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'apt-get update &amp;&amp; apt-get upgrade -y'; \
 in-target sh -c 'wget -O - http://&lt;webserver&gt;/script/install.sh | bash';
</code></pre></div><h4 id="ubuntu-18-04-preseed-script"><a href="#ubuntu-18-04-preseed-script" class="header-anchor">#</a> Ubuntu 18.04 Preseed Script</h4> <div class="language- extra-class"><pre class="language-text"><code>#### Contents of the preconfiguration file (for bionic)

### Localization
d-i debian-installer/locale string en_GB

# Keyboard selection.
# Disable automatic (interactive) keymap detection.
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/xkb-keymap select gb

### Network configuration
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string unassigned
d-i netcfg/get_domain string localdomain

# Disable that annoying WEP key dialog.
d-i netcfg/wireless_wep string

### Mirror settings
#d-i mirror/country string manual
#d-i mirror/http/hostname string 192.168.10.250
#d-i mirror/http/directory string /dist/ubuntu/ubuntu1804
#d-i mirror/http/proxy string
#d-i mirror/suite string bionic

d-i mirror/country string manual
d-i mirror/http/hostname string archive.ubuntu.com
d-i mirror/http/directory string /ubuntu
d-i mirror/http/proxy string

# Alternatively: by default, the installer uses CC.archive.ubuntu.com where
# CC is the ISO-3166-2 code for the selected country. You can preseed this
# so that it does so without asking.
d-i mirror/http/mirror select gb.archive.ubuntu.com


### Account setup
# To create a normal user account.
d-i passwd/user-fullname string m00
d-i passwd/username string m00
d-i passwd/user-password-crypted password $6$&lt;snip&gt;
d-i user-setup/allow-password-weak boolean true

# Set to true if you want to encrypt the first user's home directory.
d-i user-setup/encrypt-home boolean false

### Clock and time zone setup
d-i clock-setup/utc boolean true
d-i time/zone string Europe/London
d-i clock-setup/ntp boolean true
d-i clock-setup/ntp-server string pool.ntp.org

### Partitioning
d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string lvm
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman-auto-lvm/guided_size string max
d-i partman-auto/choose_recipe select atomic
d-i partman/default_filesystem string ext4
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

### Base system installation
d-i base-installer/install-recommends boolean true
d-i base-installer/kernel/image string linux-generic

### Package selection
tasksel tasksel/first multiselect standard

# Individual additional packages to install
d-i pkgsel/include string openssh-server open-vm-tools python-simplejson curl cifs-utils software-properties-common binutils
d-i pkgsel/upgrade select full-upgrade
d-i pkgsel/update-policy select unattended-upgrades

d-i grub-installer/only_debian boolean true
d-i grub-installer/bootdev  string default

d-i finish-install/reboot_in_progress note
d-i cdrom-detect/eject boolean false

# in-target sh -c 'usermod -p &quot;&quot; m00'; \
# in-target sh -c 'passwd -e m00'; \

#### Advanced options
### Running custom commands during the installation
d-i preseed/late_command string \
 in-target sh -c 'usermod -p &quot;!&quot; root'; \
 in-target sh -c 'mkdir -p --mode=0700 /root/.ssh &amp;&amp; echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5KaNzN+dE9ZU83seeXSJb5gX4xRANc7eHNbQuyMXvBGSP942UpHrKgmb2Hd+f1sxH5FeLaE82p4T5Hxa+YbSEKT6VQEiktqRDmTSjiTtl2GEjaDedi0UTXB/D8nZXIbsrfkAwdQ3DgSUi7X7bdPBK43ZFE81qIPzAvl0rKhrAgJcY1HFQhlNmMzxNhPWSG9s0OqmSviC1tGooicpBLr9ibBPiQ5uc5pimYRbd6+zIbFNjNy/SqT+pWVF8J6Qp4GnHIpZZ1TMn3xluYL28zD5B5ItC8gDxfH/uaalRwe0NLEPTwWkT3ipwFaFwH8vZFCdaVU8KqUSpWH59VNHFTbKt&quot; &gt; /root/.ssh/authorized_keys &amp;&amp; chmod 0600 /root/.ssh/authorized_keys';  \
 in-target sh -c 'mkdir -p --mode=0700 /home/m00/.ssh &amp;&amp; echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5KaNzN+dE9ZU83seeXSJb5gX4xRANc7eHNbQuyMXvBGSP942UpHrKgmb2Hd+f1sxH5FeLaE82p4T5Hxa+YbSEKT6VQEiktqRDmTSjiTtl2GEjaDedi0UTXB/D8nZXIbsrfkAwdQ3DgSUi7X7bdPBK43ZFE81qIPzAvl0rKhrAgJcY1HFQhlNmMzxNhPWSG9s0OqmSviC1tGooicpBLr9ibBPiQ5uc5pimYRbd6+zIbFNjNy/SqT+pWVF8J6Qp4GnHIpZZ1TMn3xluYL28zD5B5ItC8gDxfH/uaalRwe0NLEPTwWkT3ipwFaFwH8vZFCdaVU8KqUSpWH59VNHFTbKt&quot; &gt; /home/m00/.ssh/authorized_keys &amp;&amp; chmod 0600 /home/m00/.ssh/authorized_keys &amp;&amp; chown -R m00:m00 /home/m00/.ssh';  \
 in-target sh -c 'echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC6NfziEHlyzmxiU1ftIMyx8Hh8CbgiawB+wZb02aJd0Uc3lrcm+YGVxCa2jXr9hTO/YT30u4r+X91wGRJblPwyt94OqnwbGmTT+awnwshWfI8h+SP64Y4C+O9vX6b7TCmIsiXBjY35x79QfjFjHkMIZETGrU2M0v8AgfnASPR2VZw89herazZSCcvDZzmg7onGxsNulzp0s6+ldJo27clD9lXfkYtH5oZJZ+60S+lSzcAgE/EkNCAC/XwMj/qoCH2CO/oS+PR+sittw7EwJCMkt7QkQtvTDyPaLA6i2vp7JyEx8KkdsTnZm4yRr9m/I9rk3tR4DS9oj2+MPL0sfkjhMmL0jpuQaQYQczYVNo5hhAFkiVQecXHPr4G9xz4MfUy02oWGqm0hYNuWXaD1VG8Ysg3sIJQOUL7mRpjcpXh3cqP1CYF2oyKwWJh8Mwxr8nnD+F3iFJrcYqA+tgbZ+WMHLTgROK/lGVzuDx73NI9g4K0kfXjxX4AFfLjwVJmOPzzxGnAftCGFrbjENUhiwF9wBh8t825mnlItAPXo7xImmQbjwKyR5m3HKtDbXiFCbtP9DyoocABphK7+9s7kTgJnD0hzW1GqMLlWFrxRWgQniJX/ChbEaZovaLdUncPrun3HFpqQk+Np0q+l8K0CW16PYjUkZNq7warhRZ1YcKHT2Q== ansible@blasteh.uk&quot; &gt;&gt; /home/m00/.ssh/authorized_keys';  \
 in-target sh -c 'sed -i &quot;s/.*PermitRootLogin.*/PermitRootLogin prohibit-password/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'sed -i &quot;s/.*PasswordAuthentication.*/PasswordAuthentication no/g&quot; /etc/ssh/sshd_config'; \
 in-target sh -c 'sed -i &quot;s|192.168.10.250/dist/ubuntu/ubuntu1804|gb.archive.ubuntu.com/ubuntu|g&quot; /etc/apt/sources.list'; \
 in-target sh -c 'apt-get update &amp;&amp; apt-get upgrade -y';
</code></pre></div><h2 id="ubuntu-20-04"><a href="#ubuntu-20-04" class="header-anchor">#</a> Ubuntu 20.04</h2> <p>Don't really build these anymore, but I guess this is something:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#cloud-config</span>
<span class="token key atrule">autoinstall</span><span class="token punctuation">:</span>
  <span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">geoip</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">preserve_sources_list</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">primary</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>amd64<span class="token punctuation">,</span> i386<span class="token punctuation">]</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//gb.archive.ubuntu.com/ubuntu
    <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>default<span class="token punctuation">]</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//ports.ubuntu.com/ubuntu<span class="token punctuation">-</span>ports
  <span class="token key atrule">identity</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">hostname</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span> <span class="token key atrule">password</span><span class="token punctuation">:</span> &lt;snip<span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token key atrule">realname</span><span class="token punctuation">:</span> m00<span class="token punctuation">,</span> <span class="token key atrule">username</span><span class="token punctuation">:</span> m00<span class="token punctuation">}</span>
  <span class="token key atrule">keyboard</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> gb<span class="token punctuation">,</span> <span class="token key atrule">toggle</span><span class="token punctuation">:</span> <span class="token null important">null</span><span class="token punctuation">,</span> <span class="token key atrule">variant</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
  <span class="token key atrule">locale</span><span class="token punctuation">:</span> en_GB
  <span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
      <span class="token key atrule">ens160</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">}</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">ssh</span><span class="token punctuation">:</span>
    <span class="token key atrule">allow-pw</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">authorized-keys</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIGDkEih4fsWSmYe0saDobo6R2dwNBx4gLTmUEoE4qwsBAAAABHNzaDo= m00-usba&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIFGtHLAZsVSVDbiYqhaX/g4KOZs3Axqcf9fWtWPmYxeLAAAABHNzaDo= m00-usbc&quot;</span>
    <span class="token key atrule">install-server</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">ptable</span><span class="token punctuation">:</span> gpt<span class="token punctuation">,</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /dev/sda<span class="token punctuation">,</span> <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock<span class="token punctuation">,</span> <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> disk<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>sda<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>sda<span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">1048576</span><span class="token punctuation">,</span> <span class="token key atrule">flag</span><span class="token punctuation">:</span> bios_grub<span class="token punctuation">,</span> <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span>
      <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>sda<span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">1073741824</span><span class="token punctuation">,</span> <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock<span class="token punctuation">,</span> <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">fstype</span><span class="token punctuation">:</span> ext4<span class="token punctuation">,</span> <span class="token key atrule">volume</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> format<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>sda<span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">-1</span><span class="token punctuation">,</span> <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock<span class="token punctuation">,</span> <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">2</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>vg
      <span class="token key atrule">devices</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>partition<span class="token punctuation">-</span><span class="token number">2</span><span class="token punctuation">]</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> lvm_volgroup
      <span class="token key atrule">id</span><span class="token punctuation">:</span> lvm_volgroup<span class="token punctuation">-</span><span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">name</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>lv<span class="token punctuation">,</span> <span class="token key atrule">volgroup</span><span class="token punctuation">:</span> lvm_volgroup<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token key atrule">size</span><span class="token punctuation">:</span> 100%<span class="token punctuation">,</span> <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> lvm_partition<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> lvm_partition<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">fstype</span><span class="token punctuation">:</span> ext4<span class="token punctuation">,</span> <span class="token key atrule">volume</span><span class="token punctuation">:</span> lvm_partition<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> format<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">device</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /<span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> mount<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> mount<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">device</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /boot<span class="token punctuation">,</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> mount<span class="token punctuation">,</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> mount<span class="token punctuation">-</span><span class="token number">0</span><span class="token punctuation">}</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><h2 id="almalinux-9"><a href="#almalinux-9" class="header-anchor">#</a> Almalinux 9</h2> <div class="language- extra-class"><pre class="language-text"><code>lang en_GB.utf8
keyboard --xlayouts='gb'
timezone Etc/UTC --utc
rootpw --iscrypted &lt;snip&gt;
user --name=m00 --groups=wheel --iscrypted --password=&lt;snip&gt; --uid=5000 --gid=5000
reboot
text
url --url=http://192.168.10.250/dist/alma/alma9.1/BaseOS
repo --name=AppStream --baseurl=http://192.168.10.250/dist/alma/alma9.1/AppStream

#####
# Disk layout
#####
zerombr
clearpart --all --initlabel --drives=sda
part /boot --fstype xfs --size=500 --ondisk=sda --asprimary
part /boot/efi --fstype vfat --size=200 --ondisk=sda --asprimary
part pv.01 --size=10 --grow --ondisk=sda
volgroup vg_root pv.01
logvol / --fstype xfs --name=lv_root --vgname=vg_root --size=4096 --grow

skipx
firstboot --disable
authselect select minimal
selinux --enforcing
firewall --enabled --ssh

#####
# Packages
#####
%packages
@^minimal-environment
@standard
cloud-utils-growpart
git
setroubleshoot-server
vim-enhanced
whois
yum-utils
%end

#####
# Post-install scripts
#####
%post

echo &quot;PermitRootLogin prohibit-password&quot; &gt; /etc/ssh/sshd_config.d/01-sshd_settings.conf
echo &quot;PasswordAuthentication no&quot; &gt;&gt; /etc/ssh/sshd_config.d/01-sshd_settings.conf


/usr/bin/sed -i &quot;s/^%wheel\s*ALL=(ALL)\s*ALL/%wheel  ALL=(ALL)       NOPASSWD: ALL/g&quot; /etc/sudoers

curl -fsSL https://tailscale.com/install.sh | sh
git clone --depth 1 https://github.com/junegunn/fzf.git /etc/skel/.fzf


/usr/bin/mkdir -p /home/m00/.ssh
/bin/cat &gt;&gt;/home/m00/.ssh/authorized_keys &lt;&lt;EOF
sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIGDkEih4fsWSmYe0saDobo6R2dwNBx4gLTmUEoE4qwsBAAAABHNzaDo= m00-usba
sk-ssh-ed25519@openssh.com AAAAGnNrLXNzaC1lZDI1NTE5QG9wZW5zc2guY29tAAAAIFGtHLAZsVSVDbiYqhaX/g4KOZs3Axqcf9fWtWPmYxeLAAAABHNzaDo= m00-usbc
EOF
chmod 700 /home/m00/.ssh
chmod 600 /home/m00/.ssh/authorized_keys
/bin/chown m00:m00 -R /home/m00/.ssh

/usr/sbin/restorecon -R /home

/usr/bin/dnf update -y
/usr/bin/dnf kpatch auto

</code></pre></div><script>
  mediumZoom('img', {margin: 30, background: '#707070', container: {left: document.getElementsByClassName('sidebar')[0].getBoundingClientRect().width} })
</script></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/01/29 00:25+00:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/others/links.html" class="prev">
        Useful Links
      </a></span> <span class="next"><a href="/others/vscode.html">
        vscode
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5ec0f833.js" defer></script><script src="/assets/js/2.e3d7a0c0.js" defer></script><script src="/assets/js/5.6bac8baf.js" defer></script><script src="/assets/js/16.70747ffb.js" defer></script><script src="/assets/js/6.87a7cc97.js" defer></script>
  </body>
</html>
