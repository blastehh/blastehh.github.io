(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{335:function(a,e,t){"use strict";t.r(e);var s=t(12),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"pki-stuff"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pki-stuff"}},[a._v("#")]),a._v(" PKI Stuff")]),a._v(" "),e("p",[a._v("A collection of procedures for doing different things with certs and keys")]),a._v(" "),e("hr"),a._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#update-certificates-on-a-machine"}},[a._v("Update Certificates on a Machine")])]),e("li",[e("a",{attrs:{href:"#regenerate-ca-trust-files"}},[a._v("Regenerate CA trust files")])]),e("li",[e("a",{attrs:{href:"#check-expiry-of-a-cert"}},[a._v("Check Expiry of a Cert")])]),e("li",[e("a",{attrs:{href:"#match-a-certificate-to-a-key"}},[a._v("Match a Certificate to a Key")])]),e("li",[e("a",{attrs:{href:"#decrypt-a-private-key"}},[a._v("Decrypt a Private Key")])]),e("li",[e("a",{attrs:{href:"#combine-certificate-and-key-to-a-pfx"}},[a._v("Combine Certificate and Key to a .pfx")])]),e("li",[e("a",{attrs:{href:"#separate-certificate-and-key-from-a-pfx"}},[a._v("Separate Certificate and Key from a .pfx")])]),e("li",[e("a",{attrs:{href:"#convert-p7b-to-base64"}},[a._v("Convert p7b to base64")])]),e("li",[e("a",{attrs:{href:"#show-certificate-details-of-a-website"}},[a._v("Show Certificate Details of a Website")])]),e("li",[e("a",{attrs:{href:"#openssl-certificate-generation"}},[a._v("Openssl Certificate Generation")]),e("ul",[e("li",[e("a",{attrs:{href:"#csr-config-file"}},[a._v("CSR Config File")])]),e("li",[e("a",{attrs:{href:"#creating-csr-from-config-file"}},[a._v("Creating CSR From Config File")])])])])])]),e("p"),a._v(" "),e("h2",{attrs:{id:"update-certificates-on-a-machine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update-certificates-on-a-machine"}},[a._v("#")]),a._v(" Update Certificates on a Machine")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" - https://curl.haxx.se/ca/cacert.pem "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" cert-sync /dev/stdin\n")])])]),e("h2",{attrs:{id:"regenerate-ca-trust-files"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#regenerate-ca-trust-files"}},[a._v("#")]),a._v(" Regenerate CA trust files")]),a._v(" "),e("p",[a._v("Run after adding certs to "),e("code",[a._v("/etc/pki/ca-trust/source/anchors")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("update-ca-trust extract\n")])])]),e("h2",{attrs:{id:"check-expiry-of-a-cert"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#check-expiry-of-a-cert"}},[a._v("#")]),a._v(" Check Expiry of a Cert")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" cert.crt "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl x509 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-noout")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-enddate")]),a._v("\n")])])]),e("h2",{attrs:{id:"match-a-certificate-to-a-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#match-a-certificate-to-a-key"}},[a._v("#")]),a._v(" Match a Certificate to a Key")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl x509 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-noout")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-modulus")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" certificate.crt "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl md5\nopenssl rsa "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-noout")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-modulus")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" privateKey.key "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl md5\nopenssl req "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-noout")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-modulus")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" CSR.csr "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl md5\n")])])]),e("h2",{attrs:{id:"decrypt-a-private-key"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#decrypt-a-private-key"}},[a._v("#")]),a._v(" Decrypt a Private Key")]),a._v(" "),e("p",[a._v("RSA private keys look a bit like this")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIIFDjB ...\n-----END ENCRYPTED PRIVATE KEY-----\n")])])]),e("p",[a._v("Use this command to decrypt the key")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl rsa "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" encrypted.key "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" decrypted.key\n")])])]),e("h2",{attrs:{id:"combine-certificate-and-key-to-a-pfx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#combine-certificate-and-key-to-a-pfx"}},[a._v("#")]),a._v(" Combine Certificate and Key to a .pfx")]),a._v(" "),e("ul",[e("li",[a._v("Bundle CA Cert, Intermediate Cert, and Server Cert to one file,\nadd the cert to end of file")])]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl pkcs12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-export")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" domain.name.pfx "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-inkey")]),a._v(" domain.name.key "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" domain.name.crt\n")])])]),e("h2",{attrs:{id:"separate-certificate-and-key-from-a-pfx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#separate-certificate-and-key-from-a-pfx"}},[a._v("#")]),a._v(" Separate Certificate and Key from a .pfx")]),a._v(" "),e("p",[a._v("Separate files")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl pkcs12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" cert.pfx "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" key.key "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nocerts")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nodes")]),a._v("\nopenssl pkcs12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" cert.pfx "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" cert.crt "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nokeys")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-clcerts")]),a._v("\n")])])]),e("p",[a._v("Combined certificate and key in same file")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl pkcs12 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" cert.pfx "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" combined.crt\n")])])]),e("h2",{attrs:{id:"convert-p7b-to-base64"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#convert-p7b-to-base64"}},[a._v("#")]),a._v(" Convert p7b to base64")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("openssl pkcs7 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-print_certs")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-in")]),a._v(" combined.p7b "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-out")]),a._v(" combined.crt\n")])])]),e("h2",{attrs:{id:"show-certificate-details-of-a-website"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#show-certificate-details-of-a-website"}},[a._v("#")]),a._v(" Show Certificate Details of a Website")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("SITE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("google.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl s_client "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-showcerts")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-servername")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$SITE")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-connect")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$SITE")]),a._v('"')]),a._v(":443 "),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" openssl x509 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-inform")]),a._v(" pem "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-noout")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-text")]),a._v("\n")])])]),e("h2",{attrs:{id:"openssl-certificate-generation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openssl-certificate-generation"}},[a._v("#")]),a._v(" Openssl Certificate Generation")]),a._v(" "),e("h3",{attrs:{id:"csr-config-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#csr-config-file"}},[a._v("#")]),a._v(" CSR Config File")]),a._v(" "),e("div",{staticClass:"language-apacheconf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[e("code",[a._v("FQDN = servername.domain.tld\nORGNAME = MyCompany\nALTNAMES = DNS:"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$FQDN")]),a._v(" , DNS:servername , DNS:alternateName\n\n[ req ]\ndefault_bits    = 2048\ndefault_md      = sha256\nprompt          = no\nencrypt_key     = no\ndistinguished_name = dn\nreq_extensions  = req_ext\n\n[ dn ]\nC       = UK\nO       = "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ORGNAME")]),a._v("\nCN      = "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$FQDN")]),a._v("\n\n[ req_ext ]\nsubjectAltName  = "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$ALTNAMES")]),a._v("\n")])])]),e("h3",{attrs:{id:"creating-csr-from-config-file"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creating-csr-from-config-file"}},[a._v("#")]),a._v(" Creating CSR From Config File")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("openssl req -new -nodes -key myExistingPrivate.key -out myCSR.csr -config myCSRConfig.cnf\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);