(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{329:function(s,e,t){"use strict";t.r(e);var a=t(12),n=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"lvm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lvm"}},[s._v("#")]),s._v(" LVM")]),s._v(" "),e("p",[s._v("Collection of procedures for manipulating LVM stuff")]),s._v(" "),e("hr"),s._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#expand-vg-on-same-partition"}},[s._v("Expand VG on same partition")]),e("ul",[e("li",[e("a",{attrs:{href:"#expand-the-vm-disk"}},[s._v("Expand the VM disk")])]),e("li",[e("a",{attrs:{href:"#expand-partition-size"}},[s._v("Expand Partition Size")])]),e("li",[e("a",{attrs:{href:"#resize-the-pv"}},[s._v("Resize the PV")])]),e("li",[e("a",{attrs:{href:"#expand-lv"}},[s._v("Expand LV")])]),e("li",[e("a",{attrs:{href:"#resize-filesystem"}},[s._v("Resize Filesystem")])])])]),e("li",[e("a",{attrs:{href:"#expand-vg-using-new-partition"}},[s._v("Expand VG using new partition")]),e("ul",[e("li",[e("a",{attrs:{href:"#create-or-expand-the-vm-disk"}},[s._v("Create or Expand the VM disk")])]),e("li",[e("a",{attrs:{href:"#create-a-new-partition"}},[s._v("Create a new partition")])]),e("li",[e("a",{attrs:{href:"#create-a-new-pv-on-the-new-partition"}},[s._v("Create a new PV on the new partition")])]),e("li",[e("a",{attrs:{href:"#add-the-new-pv-to-the-existing-vg"}},[s._v("Add the new PV to the existing VG")])]),e("li",[e("a",{attrs:{href:"#extend-the-lv-to-use-the-new-space"}},[s._v("Extend the LV to use the new space")])]),e("li",[e("a",{attrs:{href:"#resize-the-filesystem"}},[s._v("Resize the filesystem")])])])]),e("li",[e("a",{attrs:{href:"#converting-to-lvm"}},[s._v("Converting to LVM")]),e("ul",[e("li",[e("a",{attrs:{href:"#prepare-lvm-disk"}},[s._v("Prepare LVM Disk")])]),e("li",[e("a",{attrs:{href:"#create-a-new-filesystem"}},[s._v("Create a new filesystem")])]),e("li",[e("a",{attrs:{href:"#copy-contents-to-new-filesystem"}},[s._v("Copy contents to new filesystem")])]),e("li",[e("a",{attrs:{href:"#edit-fstab"}},[s._v("Edit fstab")])]),e("li",[e("a",{attrs:{href:"#scan-the-changes"}},[s._v("Scan the changes")])]),e("li",[e("a",{attrs:{href:"#create-new-ramdisk"}},[s._v("Create new ramdisk")])]),e("li",[e("a",{attrs:{href:"#edit-grub"}},[s._v("Edit grub")])]),e("li",[e("a",{attrs:{href:"#reboot"}},[s._v("Reboot")])]),e("li",[e("a",{attrs:{href:"#create-new-pv"}},[s._v("Create New PV")])]),e("li",[e("a",{attrs:{href:"#extend-vg"}},[s._v("Extend VG")])]),e("li",[e("a",{attrs:{href:"#extend-lv"}},[s._v("Extend LV")])]),e("li",[e("a",{attrs:{href:"#resizing-the-filesystem"}},[s._v("Resizing the filesystem")])]),e("li",[e("a",{attrs:{href:"#finish"}},[s._v("Finish")])])])])])]),e("p"),s._v(" "),e("h2",{attrs:{id:"expand-vg-on-same-partition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expand-vg-on-same-partition"}},[s._v("#")]),s._v(" Expand VG on same partition")]),s._v(" "),e("p",[s._v("You want to re-use the same partition, e.g. expand sda2 and increase the size of root_pv")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sda                    8:0    0   50G  0 disk\n├─sda1                 8:1    0  487M  0 part /boot\n└─sda2                 8:5    0 49.5G  0 part\n  ├─my_vg-root_pv  253:0    0 48.6G  0 lvm  /\n  └─my_vg-swap_pv  253:1    0  980M  0 lvm  [SWAP]\n")])])]),e("h3",{attrs:{id:"expand-the-vm-disk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expand-the-vm-disk"}},[s._v("#")]),s._v(" Expand the VM disk")]),s._v(" "),e("p",[s._v("This part will be done on the hypervisor, increase the VM's disk as needed.\nOnce the disk has been resized, use one of the methods "),e("a",{attrs:{href:"https://blasteh.uk/linux/filesystem.html#detect-new-disk-size-without-reboot",target:"_blank",rel:"noopener noreferrer"}},[s._v("here"),e("OutboundLink")],1),s._v(" to detect the new disk size; otherwise reboot the system for it to detect the new size.")]),s._v(" "),e("h3",{attrs:{id:"expand-partition-size"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expand-partition-size"}},[s._v("#")]),s._v(" Expand Partition Size")]),s._v(" "),e("p",[s._v("Install "),e("code",[s._v("growpart")]),s._v(" to make this easier, the alternative is to delete and recreate the partition using "),e("code",[s._v("fdisk")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" cloud-utils-growpart\n")])])]),e("p",[s._v("Expand the disk, take note of the space between "),e("code",[s._v("/dev/sda")]),s._v(" and "),e("code",[s._v("2")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("growpart /dev/sda "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])])]),e("p",[e("code",[s._v("/dev/sda2")]),s._v(" should now show the larger size")]),s._v(" "),e("h3",{attrs:{id:"resize-the-pv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resize-the-pv"}},[s._v("#")]),s._v(" Resize the PV")]),s._v(" "),e("p",[s._v("Run "),e("code",[s._v("pvs")]),s._v(" before and after to see the difference. You should see a larger PV after running "),e("code",[s._v("pvresize")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("pvs\npvresize /dev/sda2\npvs\n")])])]),e("p",[s._v("Your VG should also be larger now, check with")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("vgs\n")])])]),e("h3",{attrs:{id:"expand-lv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expand-lv"}},[s._v("#")]),s._v(" Expand LV")]),s._v(" "),e("p",[s._v("This will resize your LV to take up all of the free space now available")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("lvextend "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" +100%FREE /dev/my_vg/root_pv\n")])])]),e("h3",{attrs:{id:"resize-filesystem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resize-filesystem"}},[s._v("#")]),s._v(" Resize Filesystem")]),s._v(" "),e("p",[s._v("Depending on your chosen filesystem, use one of the following:")]),s._v(" "),e("h4",{attrs:{id:"xfs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xfs"}},[s._v("#")]),s._v(" XFS")]),s._v(" "),e("p",[s._v("Using xfs:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#xfs_growfs <mountpoint>")]),s._v("\nxfs_growfs /\n")])])]),e("h4",{attrs:{id:"ext3-ext4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ext3-ext4"}},[s._v("#")]),s._v(" EXT3/EXT4")]),s._v(" "),e("p",[s._v("using EXT filesystem")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("resize2fs /dev/my_vg/root_pv\n")])])]),e("h2",{attrs:{id:"expand-vg-using-new-partition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expand-vg-using-new-partition"}},[s._v("#")]),s._v(" Expand VG using new partition")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("If LVM exists on partitioned areas, start with "),e("a",{attrs:{href:"#create-or-expand-the-vm-disk"}},[s._v("this")]),s._v(" section.")])]),s._v(" "),e("li",[e("p",[s._v("If LVM exists on bare disks, run this command (Assuming "),e("code",[s._v("/dev/sda")]),s._v(" is where your existing LVM resides and you just resized it):")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("pvresize /dev/sda\n")])])]),e("p",[s._v("Once resized, "),e("a",{attrs:{href:"#extend-the-lv-to-use-the-new-space"}},[s._v("skip")]),s._v(" to this section.")])])]),s._v(" "),e("h3",{attrs:{id:"create-or-expand-the-vm-disk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-or-expand-the-vm-disk"}},[s._v("#")]),s._v(" Create or Expand the VM disk")]),s._v(" "),e("p",[s._v("This part will be done on the hypervisor, move on to the next part once the VM's disk has been increased in size.")]),s._v(" "),e("h3",{attrs:{id:"create-a-new-partition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-partition"}},[s._v("#")]),s._v(" Create a new partition")]),s._v(" "),e("p",[s._v("Create a new partition on the newly added free space and then set the partition type to lvm")]),s._v(" "),e("p",[s._v("We're using "),e("code",[s._v("/dev/sda")]),s._v(" as the disk that has been expanded")]),s._v(" "),e("p",[e("code",[s._v("/dev/vg_vol")]),s._v(" as the existing VG to be extended")]),s._v(" "),e("p",[e("code",[s._v("lv_part")]),s._v(" as the partition to be extended")]),s._v(" "),e("ul",[e("li",[s._v("fdisk /dev/sda")]),s._v(" "),e("li",[s._v("Create a new primary partition at /dev/sda3 "),e("code",[s._v("n")]),s._v(", "),e("code",[s._v("p")]),s._v(", "),e("code",[s._v("3")])]),s._v(" "),e("li",[s._v("Check the partition table "),e("code",[s._v("p")])]),s._v(" "),e("li",[s._v("Change the partition type to "),e("em",[e("strong",[s._v("Linux LVM")])]),s._v(" "),e("code",[s._v("t")]),s._v(", "),e("code",[s._v("3")]),s._v(", "),e("code",[s._v("8e")])]),s._v(" "),e("li",[s._v("Check the partition table again "),e("code",[s._v("p")])]),s._v(" "),e("li",[s._v("Write the changes "),e("code",[s._v("w")])]),s._v(" "),e("li",[s._v("Reboot to save changes (if required)")])]),s._v(" "),e("h3",{attrs:{id:"create-a-new-pv-on-the-new-partition"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-pv-on-the-new-partition"}},[s._v("#")]),s._v(" Create a new PV on the new partition")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("pvcreate /dev/sda3")])]),s._v(" "),e("li",[s._v("Check the created PV "),e("code",[s._v("pvdisplay")])])]),s._v(" "),e("h3",{attrs:{id:"add-the-new-pv-to-the-existing-vg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#add-the-new-pv-to-the-existing-vg"}},[s._v("#")]),s._v(" Add the new PV to the existing VG")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("vgextend /dev/vg_vol /dev/sda3")])]),s._v(" "),e("li",[e("code",[s._v("vgdisplay")])])]),s._v(" "),e("h3",{attrs:{id:"extend-the-lv-to-use-the-new-space"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extend-the-lv-to-use-the-new-space"}},[s._v("#")]),s._v(" Extend the LV to use the new space")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("lvextend -l +100%FREE /dev/vg_vol/lv_part")])])]),s._v(" "),e("h3",{attrs:{id:"resize-the-filesystem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resize-the-filesystem"}},[s._v("#")]),s._v(" Resize the filesystem")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("resize2fs /dev/vg_vol/lv_part")])])]),s._v(" "),e("h2",{attrs:{id:"converting-to-lvm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#converting-to-lvm"}},[s._v("#")]),s._v(" Converting to LVM")]),s._v(" "),e("p",[s._v("We will copy our main root partition to a new empty disk and then extend the lvm partition to use the original disk after it has been copied over.\nThis assumes that you are using a separate /boot partition.")]),s._v(" "),e("h3",{attrs:{id:"prepare-lvm-disk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prepare-lvm-disk"}},[s._v("#")]),s._v(" Prepare LVM Disk")]),s._v(" "),e("p",[s._v("This is our initial state:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n├─sda1   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot/efi\n├─sda2   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n├─sda3   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /\n└─sda4   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":4    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsdb      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n└─sdb1   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":17   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n")])])]),e("p",[s._v("We'll use "),e("code",[s._v("/dev/sdb")]),s._v(" as our new disk for creating the LVM filesystem")]),s._v(" "),e("p",[e("code",[s._v("vg_main")]),s._v(" as our new VG")]),s._v(" "),e("p",[e("code",[s._v("lv_root")]),s._v(" as our new LV")]),s._v(" "),e("ul",[e("li",[s._v("Create the new partition with "),e("code",[s._v("fdisk /dev/sdb")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n├─sda1   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot/efi\n├─sda2   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n├─sda3   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /\n└─sda4   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":4    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsdb      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n├─sdb1   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":17   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n└─sdb2   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":18   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n")])])]),e("ul",[e("li",[e("code",[s._v("pvcreate /dev/sdb2")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvcreate /dev/sdb2")]),s._v("\n  Physical volume "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/sdb2"')]),s._v(" successfully created\n")])])]),e("ul",[e("li",[e("code",[s._v("vgcreate vg_main /dev/sdb2")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgcreate vg_main /dev/sdb2")]),s._v("\n  Volume group "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg_main"')]),s._v(" successfully created\n")])])]),e("p",[s._v("Here's our state so far:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgdisplay")]),s._v("\n  --- Volume group ---\n  VG Name               vg_main\n  System ID\n  Format                lvm2\n  Metadata Areas        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Metadata Sequence No  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Cur LV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Open LV               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Max PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Cur PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Act PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  VG Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  PE Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v(" MiB\n  Total PE              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  Alloc PE / Size       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" / "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Free  PE / Size       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v(" / "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  VG UUID               ltBtnM-2Oxu-WVWk-YcLY-wLHy-AZiE-dm2MiR\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvdisplay")]),s._v("\n  --- Physical volume ---\n  PV Name               /dev/sdb2\n  VG Name               vg_main\n  PV Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB / not usable "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.07")]),s._v(" MiB\n  Allocatable           "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n  PE Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v(" MiB\n  Total PE              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  Free PE               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  Allocated PE          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  PV UUID               o8svsy-NUwd-2mOe-6PWx-Taop-Cf44-MxA19c\n")])])]),e("p",[s._v("We'll use 100% of the free space on this disk")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("lvcreate --name lv_root vg_main -l 100%FREE")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvcreate --name lv_root vg_main -l 100%FREE")]),s._v("\n  Logical volume "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lv_root"')]),s._v(" created.\n")])])]),e("p",[s._v("And our state:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvdisplay")]),s._v("\n  --- Logical volume ---\n  LV Path                /dev/vg_main/lv_root\n  LV Name                lv_root\n  VG Name                vg_main\n  LV UUID                9y6COH-813Z-AU6u-nAtd-CdCA-leOS-NgT57S\n  LV Write Access        read/write\n  LV Creation host, "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" ns3099345, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-09-01 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":28:21 +0200\n  LV Status              available\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# open                 0")]),s._v("\n  LV Size                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  Current LE             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  Segments               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n  Block device           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("252")]),s._v(":0\n")])])]),e("h3",{attrs:{id:"create-a-new-filesystem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-a-new-filesystem"}},[s._v("#")]),s._v(" Create a new filesystem")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("mkfs.ext4 /dev/vg_main/lv_root")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkfs.ext4 /dev/vg_main/lv_root")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mke2fs")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(".13 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("-May-2015"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCreating filesystem with "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("488247296")]),s._v(" 4k blocks and "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("122068992")]),s._v(" inodes\nFilesystem UUID: 21a20292-bbaa-47a0-9634-138922619019\nSuperblock backups stored on blocks:\n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("98304")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("163840")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("229376")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("294912")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("819200")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("884736")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1605632")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2654208")]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096000")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7962624")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11239424")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("20480000")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("23887872")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("71663616")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("78675968")]),s._v(",\n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400000")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("214990848")]),s._v("\n\nAllocating group tables: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nWriting inode tables: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nCreating journal "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v(" blocks"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nWriting superblocks and filesystem accounting information: "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),e("h3",{attrs:{id:"copy-contents-to-new-filesystem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#copy-contents-to-new-filesystem"}},[s._v("#")]),s._v(" Copy contents to new filesystem")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("mkdir /mnt/sdb")])]),s._v(" "),e("li",[e("code",[s._v("mount /dev/vg_main/lv_root /mnt/sdb")])]),s._v(" "),e("li",[e("code",[s._v("cp -dpRx / /mnt/sdb/")])])]),s._v(" "),e("h3",{attrs:{id:"edit-fstab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#edit-fstab"}},[s._v("#")]),s._v(" Edit fstab")]),s._v(" "),e("p",[s._v("We will need to add the disk in to our copied disk")]),s._v(" "),e("ul",[e("li",[s._v("Grab UUID with "),e("code",[s._v("blkid")])])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# blkid\n/dev/sda1: LABEL="EFI_SYSPART" UUID="9F4B-3971" TYPE="vfat" PARTLABEL="primary" PARTUUID="cf755262-1548-4bff-9304-ea4c5cc5035d"\n/dev/sda2: LABEL="/boot" UUID="1a818491-c638-4db2-988d-db2894f76d0d" TYPE="ext4" PARTLABEL="primary" PARTUUID="064c46cc-725b-4cf1-ba80-f0e194ebae99"\n/dev/sda3: LABEL="/" UUID="a77a87e5-a10d-4655-b633-48676cfa3b2a" TYPE="ext4" PARTLABEL="primary" PARTUUID="fcd69399-1f5a-49fe-9d61-03d51f734e75"\n/dev/sda4: LABEL="swap-sda4" UUID="68cae6eb-bc9a-42a8-ba07-91bbeb2cbb9a" TYPE="swap" PARTLABEL="primary" PARTUUID="898360d2-9b48-482c-a669-86c529d1f2af"\n/dev/sdb1: LABEL="EFI_SYSPART" UUID="A00D-3109" TYPE="vfat" PARTLABEL="primary" PARTUUID="225b4983-72a6-4131-927c-9010c21382cd"\n/dev/sdb2: UUID="o8svsy-NUwd-2mOe-6PWx-Taop-Cf44-MxA19c" TYPE="LVM2_member" PARTUUID="a49e995c-a690-4b35-98cf-865047688ad3"\n/dev/mapper/vg_main-lv_root: UUID="21a20292-bbaa-47a0-9634-138922619019" TYPE="ext4"\n')])])]),e("ul",[e("li",[e("code",[s._v("nano /mnt/sdb/etc/fstab")])])]),s._v(" "),e("p",[s._v("Add "),e("code",[s._v("UUID=")]),s._v(" to the UUID itself and place it in the file")]),s._v(" "),e("p",[s._v("This is what the result looks like:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# <file system> <mount point>   <type>  <options>       <dump>  <pass>\n#/dev/sda3      /       ext4    errors=remount-ro,relatime      0       1\nUUID=21a20292-bbaa-47a0-9634-138922619019 /       ext4    errors=remount-ro,relatime      0       1\n/dev/sda2       /boot   ext4    errors=remount-ro,relatime      0       1\n/dev/sda4       swap    swap    defaults        0       0\nproc            /proc   proc    defaults                0       0\nsysfs           /sys    sysfs   defaults                0       0\n/dev/sda1       /boot/efi       vfat    defaults,relatime       0       0\ndevtmpfs        /dev    devtmpfs        rw      0       0\n")])])]),e("h3",{attrs:{id:"scan-the-changes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#scan-the-changes"}},[s._v("#")]),s._v(" Scan the changes")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("vgscan")])]),s._v(" "),e("li",[e("code",[s._v("vgchange -ay")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgscan")]),s._v("\n  Reading all physical volumes.  This may take a while"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  Found volume group "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg_main"')]),s._v(" using metadata "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" lvm2\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgchange -ay")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logical volume"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" volume group "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg_main"')]),s._v(" now active\n")])])]),e("h3",{attrs:{id:"create-new-ramdisk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-new-ramdisk"}},[s._v("#")]),s._v(" Create new ramdisk")]),s._v(" "),e("p",[s._v("This step may be needed if your existing ramdisk is not aware of LVM")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("mkinitramfs -o /boot/initrd-$(uname -r).lvm.img")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkinitramfs -o /boot/initrd-$(uname -r).lvm.img")]),s._v("\nW: mdadm: /etc/mdadm/mdadm.conf defines no arrays.\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -lah /boot")]),s._v("\ntotal 85M\ndrwxr-xr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".0K Sep  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":35 "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndrwxr-xr-x "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Sep  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":04 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2M Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 abi-4.4.0-134-generic\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root 187K Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 config-4.4.0-134-generic\ndrwxr-xr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Jan  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1970")]),s._v(" efi\ndrwxr-xr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".0K Sep  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":58 grub\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  37M Sep  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":35 initrd-4.4.0-134-generic.lvm.img\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  37M Sep  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":04 initrd.img-4.4.0-134-generic\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v(" Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 retpoline-4.4.0-134-generic\n-rw-------  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8M Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 System.map-4.4.0-134-generic\n-rw-------  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".9M Aug "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":48 vmlinuz-4.4.0-134-generic\n")])])]),e("h3",{attrs:{id:"edit-grub"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#edit-grub"}},[s._v("#")]),s._v(" Edit grub")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("nano /boot/grub/grub.cfg")])]),s._v(" "),e("li",[s._v("Add "),e("code",[s._v("/dev/vg_main/lv_root")]),s._v(" to the root directory")]),s._v(" "),e("li",[s._v("Change initrd image to the one created earlier "),e("code",[s._v("mkinitramfs -o /boot/initrd-$(uname -r).lvm.img")])])]),s._v(" "),e("p",[s._v("Result")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("---snip---\n\nmenuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-a77a87e5-a10d-4655-b633-48676cfa3b2a' {\n        recordfail\n        load_video\n        gfxmode $linux_gfx_mode\n        insmod gzio\n        if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi\n        insmod part_gpt\n        insmod ext2\n        set root='hd0,gpt2'\n        if [ x$feature_platform_search_hint = xy ]; then\n          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  1a818491-c638-4db2-988d-db2894f76d0d\n        else\n          search --no-floppy --fs-uuid --set=root 1a818491-c638-4db2-988d-db2894f76d0d\n        fi\n        linux   /vmlinuz-4.4.0-134-generic root=/dev/vg_main/lv_root ro  noquiet nosplash net.ifnames=0 biosdevname=0\n        initrd  /initrd-4.4.0-134-generic.lvm.img\n\n---snip---\n")])])]),e("h3",{attrs:{id:"reboot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#reboot"}},[s._v("#")]),s._v(" Reboot")]),s._v(" "),e("p",[s._v("Check that your server comes back up, once it does, it should look like this:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk")]),s._v("\nNAME                MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n├─sda1                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot/efi\n├─sda2                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":2    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /boot\n├─sda3                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":3    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n└─sda4                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":4    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SWAP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nsdb                   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n├─sdb1                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":17   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  511M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n└─sdb2                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":18   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part\n  └─vg_main-lv_root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("252")]),s._v(":0    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem            Size  Used Avail Use% Mounted on\nudev                   16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".2G   14M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".1G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\n/dev/vg_main/lv_root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".5G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".7T   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/lock\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/sda2             487M   97M  362M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("% /boot\n/dev/sda1             510M  136K  510M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /boot/efi\n")])])]),e("p",[s._v("You can see that the "),e("code",[s._v("/")]),s._v(" partition is mounted on "),e("code",[s._v("/dev/sdb2")]),s._v(" now.")]),s._v(" "),e("h3",{attrs:{id:"create-new-pv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-new-pv"}},[s._v("#")]),s._v(" Create New PV")]),s._v(" "),e("ul",[e("li",[s._v("Check your disk layout "),e("code",[s._v("fdisk -l")]),s._v(" or "),e("code",[s._v("lsblk")])])]),s._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[s._v("DANGER")]),s._v(" "),e("p",[s._v("Do not delete your boot partition!")])]),s._v(" "),e("ul",[e("li",[e("code",[s._v("pvcreate /dev/sda3")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvcreate /dev/sda3")]),s._v("\nWARNING: ext4 signature detected on /dev/sda3 at offset "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1080")]),s._v(". Wipe it? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n  Wiping ext4 signature on /dev/sda3.\n  Physical volume "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/sda3"')]),s._v(" successfully created\n")])])]),e("ul",[e("li",[s._v("Check the new PV "),e("code",[s._v("pvdisplay")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvdisplay")]),s._v("\n  --- Physical volume ---\n  PV Name               /dev/sdb2\n  VG Name               vg_main\n  PV Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB / not usable "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.07")]),s._v(" MiB\n  Allocatable           "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("but full"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PE Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v(" MiB\n  Total PE              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  Free PE               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Allocated PE          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v("\n  PV UUID               o8svsy-NUwd-2mOe-6PWx-Taop-Cf44-MxA19c\n\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/sda3"')]),s._v(" is a new physical volume of "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.82 TiB"')]),s._v("\n  --- NEW Physical volume ---\n  PV Name               /dev/sda3\n  VG Name\n  PV Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  Allocatable           NO\n  PE Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Total PE              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Free PE               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Allocated PE          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  PV UUID               3uJ1oO-kt5i-cjnR-kHU8-1jOc-1jzx-Wa1gXj\n")])])]),e("h3",{attrs:{id:"extend-vg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extend-vg"}},[s._v("#")]),s._v(" Extend VG")]),s._v(" "),e("ul",[e("li",[s._v("Extend your VG "),e("code",[s._v("vgextend /dev/vg_main /dev/sda3")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgextend /dev/vg_main /dev/sda3")]),s._v("\n  Volume group "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg_main"')]),s._v(" successfully extended\n")])])]),e("ul",[e("li",[s._v("Check your VG "),e("code",[s._v("vgdisplay")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgdisplay")]),s._v("\n  --- Volume group ---\n  VG Name               vg_main\n  System ID\n  Format                lvm2\n  Metadata Areas        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Metadata Sequence No  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Cur LV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Open LV               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Max PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  Cur PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Act PV                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  VG Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.64")]),s._v(" TiB\n  PE Size               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.00")]),s._v(" MiB\n  Total PE              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("953351")]),s._v("\n  Alloc PE / Size       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v(" / "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  Free  PE / Size       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476547")]),s._v(" / "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB\n  VG UUID               ltBtnM-2Oxu-WVWk-YcLY-wLHy-AZiE-dm2MiR\n")])])]),e("h3",{attrs:{id:"extend-lv"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#extend-lv"}},[s._v("#")]),s._v(" Extend LV")]),s._v(" "),e("ul",[e("li",[s._v("Extend your LV "),e("code",[s._v("lvextend -l +100%FREE /dev/vg_main/lv_root")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvextend -l +100%FREE /dev/vg_main/lv_root")]),s._v("\n  Size of logical volume vg_main/lv_root changed from "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.82")]),s._v(" TiB "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("476804")]),s._v(" extents"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.64")]),s._v(" TiB "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("953351")]),s._v(" extents"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n  Logical volume lv_root successfully resized.\n")])])]),e("ul",[e("li",[s._v("Check your LV "),e("code",[s._v("lvs")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs")]),s._v("\n  LV      VG      Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  lv_root vg_main -wi-ao---- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".64t\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvdisplay")]),s._v("\n  --- Logical volume ---\n  LV Path                /dev/vg_main/lv_root\n  LV Name                lv_root\n  VG Name                vg_main\n  LV UUID                9y6COH-813Z-AU6u-nAtd-CdCA-leOS-NgT57S\n  LV Write Access        read/write\n  LV Creation host, "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" ns3099345, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-09-01 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":28:21 +0200\n  LV Status              available\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# open                 1")]),s._v("\n  LV Size                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.64")]),s._v(" TiB\n  Current LE             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("953351")]),s._v("\n  Segments               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n  Block device           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("252")]),s._v(":0\n")])])]),e("h3",{attrs:{id:"resizing-the-filesystem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resizing-the-filesystem"}},[s._v("#")]),s._v(" Resizing the filesystem")]),s._v(" "),e("ul",[e("li",[s._v("Resize the partition "),e("code",[s._v("resize2fs /dev/vg_main/lv_root")]),s._v("\nBefore:")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem            Size  Used Avail Use% Mounted on\nudev                   16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".2G   14M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".1G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\n/dev/vg_main/lv_root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".8T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".5G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".7T   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/lock\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/sda2             487M   97M  362M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("% /boot\n/dev/sda1             510M  136K  510M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /boot/efi\n")])])]),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# resize2fs /dev/vg_main/lv_root")]),s._v("\nresize2fs "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.42")]),s._v(".13 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("-May-2015"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFilesystem at /dev/vg_main/lv_root is mounted on /"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" on-line resizing required\nold_desc_blocks "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("117")]),s._v(", new_desc_blocks "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("233")]),s._v("\nThe filesystem on /dev/vg_main/lv_root is now "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("976231424")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("4k"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" blocks long.\n")])])]),e("p",[s._v("After:")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# df -h")]),s._v("\nFilesystem            Size  Used Avail Use% Mounted on\nudev                   16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".2G   14M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".1G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /run\n/dev/vg_main/lv_root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".6T  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".5G  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".5T   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".0M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/lock\ntmpfs                  16G     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   16G   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/sda2             487M   97M  362M  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("% /boot\n/dev/sda1             510M  136K  510M   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /boot/efi\n")])])]),e("h3",{attrs:{id:"finish"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#finish"}},[s._v("#")]),s._v(" Finish")]),s._v(" "),e("p",[s._v("Reboot your system to make sure everything comes back.")])])}),[],!1,null,null,null);e.default=n.exports}}]);